<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>QR Code Generator</title>
    <!-- Include the QRCode.js library from a CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="stylesheet" href="./style.css">
    <!-- Add some CSS for dark theme and styling -->
</head>
<body>
    <div class="main">
        <div class="qr">
            <h2>QR Code Generator</h2>
            <hr>
            <div class="qrinput">
                <input type="text" id="text-input" placeholder="Give Input here">
            </div>
            <div class="qrbutton">
                <button onclick="generateQR()">Generate QR Code</button>
            </div>
            <div id="qr-code"></div>
            <div class="qrbutton download">
                <button onclick="downloadQR()">Download QR</button>  
            </div>          
        </div>
    </div>

    <script>
        function generateQR() {
            // Get the text from the input box
            var text = document.getElementById("text-input").value;

            // Clear any existing QR code
            var qrCodeContainer = document.getElementById("qr-code");
            qrCodeContainer.innerHTML = "";

            if (text.trim() === "") {
                alert("Please enter some text.");
                return;
            }

            // Create a new div to hold the QR code with card styling
            var qrCard = document.createElement("div");
            qrCard.className = "qr-card";
            qrCodeContainer.appendChild(qrCard);

            // Generate the QR code inside the card
            new QRCode(qrCard, {
                text: text,
                width: 200,
                height: 200,
                colorDark : "#222831", /* Dark color for QR code */
                colorLight : "#EEEEEE", /* Light background for QR code */
            });
        }

        function downloadQR() {
            // Select the canvas element generated by the QRCode library
            var qrCanvas = document.querySelector('.qr-card canvas'); 

            if (!qrCanvas) {
                alert("Please generate a QR code first.");
                return;
            }

            // Convert the canvas to a data URL (PNG image)
            var qrImage = qrCanvas.toDataURL("image/png");

            // Create a Blob from the data URL
            var blob = dataURLToBlob(qrImage);

            // Create an <a> element for download
            var link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'qr-code.png'; // Specify the file name for the QR code image
            link.click(); // Programmatically click the link to trigger the download
        }

        // Helper function to convert data URL to Blob
        function dataURLToBlob(dataURL) {
            var byteString = atob(dataURL.split(',')[1]);
            var mimeString = dataURL.split(',')[0].split(':')[1].split(';')[0];

            var ab = new ArrayBuffer(byteString.length);
            var ia = new Uint8Array(ab);
            for (var i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }

            return new Blob([ab], { type: mimeString });
        }
    </script>
</body>
</html>
